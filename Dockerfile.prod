FROM node:18

WORKDIR /app

COPY package*.json ./
RUN npm install --production

COPY prisma ./prisma/
COPY . .

# Set environment variables before running Prisma commands
ENV DATABASE_URL="postgresql://user:password@localhost:5432/mydatabase?schema=public"

RUN npx prisma migrate deploy
RUN npx prisma generate

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
